<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Treinamento - Cadastro de Motoristas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 2rem 0;
        }
        
        .training-container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .training-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 2.5rem;
            text-align: center;
        }
        
        .training-header h1 {
            margin: 0;
            font-size: 2rem;
            font-weight: 700;
        }
        
        .training-header p {
            margin: 0.5rem 0 0 0;
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .training-content {
            padding: 2.5rem;
        }
        
        .section {
            margin-bottom: 2.5rem;
            padding-bottom: 2rem;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .section:last-child {
            border-bottom: none;
        }
        
        .section-title {
            color: var(--primary);
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .section-title i {
            font-size: 1.3rem;
        }
        
        .step {
            background: #f8fafc;
            border-left: 4px solid var(--primary);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-radius: 8px;
        }
        
        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            font-weight: 700;
            margin-right: 1rem;
            font-size: 1rem;
        }
        
        .step-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.75rem;
        }
        
        .step-content {
            color: #4b5563;
            line-height: 1.8;
        }
        
        .step-content ul {
            margin: 1rem 0;
            padding-left: 1.5rem;
        }
        
        .step-content li {
            margin-bottom: 0.5rem;
        }
        
        .highlight {
            background: #fef3c7;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-weight: 600;
            color: #92400e;
        }
        
        .warning-box {
            background: #fef3c7;
            border-left: 4px solid var(--warning);
            padding: 1rem 1.5rem;
            border-radius: 8px;
            margin: 1rem 0;
        }
        
        .warning-box i {
            color: var(--warning);
            margin-right: 0.5rem;
        }
        
        .success-box {
            background: #d1fae5;
            border-left: 4px solid var(--success);
            padding: 1rem 1.5rem;
            border-radius: 8px;
            margin: 1rem 0;
        }
        
        .success-box i {
            color: var(--success);
            margin-right: 0.5rem;
        }
        
        .field-info {
            background: #e0e7ff;
            padding: 1rem;
            border-radius: 8px;
            margin: 0.5rem 0;
        }
        
        .field-info strong {
            color: var(--primary);
        }
        
        .signature-section {
            background: #f9fafb;
            padding: 2rem;
            border-radius: 12px;
            margin-top: 2rem;
            border: 2px dashed #d1d5db;
        }
        
        .signature-box {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .signature-field {
            margin-bottom: 1.5rem;
        }
        
        .signature-field label {
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.5rem;
            display: block;
        }
        
        .signature-field input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .signature-field input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .print-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 1rem 1.5rem;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            cursor: pointer;
            z-index: 1000;
            transition: all 0.3s;
        }
        
        .print-btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.2);
        }
        
        @media print {
            .print-btn {
                display: none;
            }
            
            body {
                background: white;
            }
            
            .training-container {
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
    <button class="print-btn" onclick="window.print()">
        <i class="fas fa-print me-2"></i>Imprimir / Salvar PDF
    </button>
    
    <div style="max-width: 900px; margin: 0 auto; padding: 0 1.5rem 1rem 1.5rem;">
        <a href="treinamentos.html" class="btn-back" style="background: #6b7280; color: white; border: none; border-radius: 12px; padding: 0.75rem 1.5rem; font-weight: 600; text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem; transition: all 0.3s;">
            <i class="fas fa-arrow-left"></i> Voltar aos Treinamentos
        </a>
    </div>
    
    <div class="training-container">
        <div class="training-header">
            <h1><i class="fas fa-graduation-cap me-2"></i>Treinamento</h1>
            <p>Cadastro de Motoristas no Sistema</p>
        </div>
        
        <div class="training-content">
            <!-- Se√ß√£o 1: Introdu√ß√£o -->
            <div class="section">
                <div class="section-title">
                    <i class="fas fa-info-circle"></i>
                    Introdu√ß√£o
                </div>
                <p>Este documento cont√©m as instru√ß√µes completas para realizar o cadastro de novos motoristas no sistema. Siga os passos abaixo cuidadosamente para garantir que todos os dados sejam inseridos corretamente.</p>
                
                <div class="success-box">
                    <i class="fas fa-check-circle"></i>
                    <strong>Objetivo:</strong> Capacitar o usu√°rio a cadastrar motoristas de forma correta e completa no sistema.
                </div>
            </div>
            
            <!-- Se√ß√£o 2: Acesso -->
            <div class="section">
                <div class="section-title">
                    <i class="fas fa-sign-in-alt"></i>
                    Acesso ao Sistema
                </div>
                
                <div class="step">
                    <div class="step-title">
                        <span class="step-number">1</span>
                        Acesse a p√°gina de cadastro
                    </div>
                    <div class="step-content">
                        <p>Fa√ßa login no sistema e navegue at√© a p√°gina <strong>"Cadastro de Motoristas"</strong> atrav√©s do menu principal.</p>
                    </div>
                </div>
            </div>
            
            <!-- Se√ß√£o 3: Passo a Passo -->
            <div class="section">
                <div class="section-title">
                    <i class="fas fa-list-ol"></i>
                    Passo a Passo do Cadastro
                </div>
                
                <div class="step">
                    <div class="step-title">
                        <span class="step-number">2</span>
                        Informa√ß√µes Pessoais
                    </div>
                    <div class="step-content">
                        <p>Preencha os dados pessoais do motorista:</p>
                        <ul>
                            <li><strong>Nome Completo *</strong> - Campo obrigat√≥rio. Digite o nome completo do motorista.</li>
                            <li><strong>CNH</strong> - N√∫mero da Carteira Nacional de Habilita√ß√£o (11 d√≠gitos).</li>
                            <li><strong>Categoria CNH</strong> - Selecione a categoria (A, B, C, D ou E).</li>
                            <li><strong>Telefone 1 *</strong> - Campo obrigat√≥rio. Telefone principal do motorista (com DDD).</li>
                            <li><strong>Telefone 2</strong> - Telefone secund√°rio (opcional).</li>
                            <li><strong>Estado</strong> - UF do estado de origem (opcional).</li>
                        </ul>
                        
                        <div class="warning-box">
                            <i class="fas fa-exclamation-triangle"></i>
                            <strong>Aten√ß√£o:</strong> Os campos marcados com (*) s√£o obrigat√≥rios e devem ser preenchidos.
                        </div>
                    </div>
                </div>
                
                <div class="step">
                    <div class="step-title">
                        <span class="step-number">3</span>
                        Sele√ß√£o da Classe do Ve√≠culo
                    </div>
                    <div class="step-content">
                        <p>Selecione a classe do ve√≠culo que o motorista opera:</p>
                        <ul>
                            <li><strong>Leve</strong> - Ve√≠culos leves (carros, vans pequenas)</li>
                            <li><strong>M√©dio</strong> - Ve√≠culos m√©dios (vans grandes, caminh√µes pequenos)</li>
                            <li><strong>Pesado</strong> - Ve√≠culos pesados (caminh√µes, carretas)</li>
                        </ul>
                        
                        <div class="field-info">
                            <strong>Como fazer:</strong> Clique no bot√£o correspondente √† classe do ve√≠culo. O bot√£o ficar√° destacado quando selecionado.
                        </div>
                        
                        <div class="warning-box">
                            <i class="fas fa-exclamation-triangle"></i>
                            <strong>Importante:</strong> Ap√≥s selecionar a classe, os campos "Tipo de Ve√≠culo" e "Carroceria" ser√£o habilitados automaticamente.
                        </div>
                    </div>
                </div>
                
                <div class="step">
                    <div class="step-title">
                        <span class="step-number">4</span>
                        Informa√ß√µes do Ve√≠culo
                    </div>
                    <div class="step-content">
                        <p>Preencha as informa√ß√µes do ve√≠culo:</p>
                        <ul>
                            <li><strong>Tipo de Ve√≠culo *</strong> - Selecione o tipo (ex: Caminh√£o, Carreta, Van, etc.)</li>
                            <li><strong>Carroceria *</strong> - Selecione o tipo de carroceria:
                                <ul>
                                    <li>Para <strong>Leve/M√©dio:</strong> Ba√∫, Furg√£o, Grade Baixa, etc.</li>
                                    <li>Para <strong>Pesado:</strong> Grade Baixa, Truck, Sider, Graneleiro, Basculante, Porta Container 20, Porta Container 40, Ba√∫, etc.</li>
                                </ul>
                            </li>
                            <li><strong>Placa do Cavalo *</strong> - Placa principal do ve√≠culo (formato: ABC1D23)</li>
                            <li><strong>Placa da Carreta 1</strong> - Placa da primeira carreta (se aplic√°vel)</li>
                            <li><strong>Placa da Carreta 2</strong> - Placa da segunda carreta (se aplic√°vel)</li>
                            <li><strong>Placa da Carreta 3</strong> - Placa da terceira carreta (se aplic√°vel)</li>
                        </ul>
                        
                        <div class="success-box">
                            <i class="fas fa-lightbulb"></i>
                            <strong>Dica:</strong> Para ve√≠culos simples (sem carreta), preencha apenas a placa do cavalo. Para ve√≠culos com reboque/carreta, preencha todas as placas.
                        </div>
                    </div>
                </div>
                
                <div class="step">
                    <div class="step-title">
                        <span class="step-number">5</span>
                        Status do Motorista
                    </div>
                    <div class="step-content">
                        <p>Selecione o status inicial do motorista:</p>
                        <ul>
                            <li><strong>Ativo</strong> - Motorista est√° ativo e pode receber mensagens (padr√£o)</li>
                            <li><strong>Inativo</strong> - Motorista n√£o est√° operando no momento</li>
                            <li><strong>Bloqueado</strong> - Motorista foi bloqueado do sistema</li>
                        </ul>
                        
                        <div class="field-info">
                            <strong>Recomenda√ß√£o:</strong> Para novos cadastros, mantenha o status como "Ativo" para que o motorista receba as mensagens.
                        </div>
                    </div>
                </div>
                
                <div class="step">
                    <div class="step-title">
                        <span class="step-number">6</span>
                        Finalizar Cadastro
                    </div>
                    <div class="step-content">
                        <ol>
                            <li>Revise todos os dados preenchidos</li>
                            <li>Verifique se todos os campos obrigat√≥rios (*) est√£o preenchidos</li>
                            <li>Clique no bot√£o <strong>"Cadastrar Motorista"</strong></li>
                            <li>Aguarde a mensagem de confirma√ß√£o de sucesso</li>
                        </ol>
                        
                        <div class="success-box">
                            <i class="fas fa-check-circle"></i>
                            <strong>Sucesso!</strong> Se o cadastro foi realizado com √™xito, voc√™ ver√° uma mensagem de confirma√ß√£o e o formul√°rio ser√° limpo automaticamente.
                        </div>
                        
                        <div class="warning-box">
                            <i class="fas fa-exclamation-triangle"></i>
                            <strong>Em caso de erro:</strong> Verifique a mensagem de erro exibida e corrija os campos indicados. Campos com erro geralmente aparecem destacados em vermelho.
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Se√ß√£o 4: Dicas Importantes -->
            <div class="section">
                <div class="section-title">
                    <i class="fas fa-lightbulb"></i>
                    Dicas e Boas Pr√°ticas
                </div>
                
                <div class="step-content">
                    <ul>
                        <li><strong>Precis√£o nos dados:</strong> Sempre verifique se os telefones e placas est√£o corretos antes de finalizar o cadastro.</li>
                        <li><strong>Formato de telefone:</strong> Digite o n√∫mero completo com DDD, sem espa√ßos ou caracteres especiais (ex: 11987654321).</li>
                        <li><strong>Formato de placa:</strong> Use letras mai√∫sculas e n√∫meros, sem espa√ßos ou h√≠fens (ex: ABC1D23).</li>
                        <li><strong>CNH:</strong> Se a CNH for informada, deve conter exatamente 11 d√≠gitos num√©ricos.</li>
                        <li><strong>Edi√ß√£o:</strong> Caso precise corrigir algum dado, voc√™ pode editar o motorista atrav√©s da aba "Gest√£o de Contatos".</li>
                    </ul>
                </div>
            </div>
            
            <!-- Se√ß√£o 5: Checklist -->
            <div class="section">
                <div class="section-title">
                    <i class="fas fa-check-square"></i>
                    Checklist de Verifica√ß√£o
                </div>
                
                <div class="step-content">
                    <p>Antes de finalizar o cadastro, verifique se:</p>
                    <ul>
                        <li>‚òê Nome completo est√° preenchido e correto</li>
                        <li>‚òê Telefone 1 est√° preenchido e no formato correto</li>
                        <li>‚òê Classe do ve√≠culo foi selecionada</li>
                        <li>‚òê Tipo de ve√≠culo foi selecionado</li>
                        <li>‚òê Tipo de carroceria foi selecionado</li>
                        <li>‚òê Placa do cavalo est√° preenchida (se aplic√°vel)</li>
                        <li>‚òê Status do motorista foi definido</li>
                    </ul>
                </div>
            </div>
            
            <!-- Se√ß√£o 6: Assinatura -->
            <div class="signature-section">
                <div class="section-title">
                    <i class="fas fa-signature"></i>
                    Declara√ß√£o de Conclus√£o do Treinamento
                </div>
                
                <p>Declaro que recebi e compreendi as instru√ß√µes para cadastro de motoristas no sistema e estou apto(a) a realizar esta atividade.</p>
                
                <div class="signature-box">
                    <div class="signature-field">
                        <label>Nome Completo:</label>
                        <input type="text" id="sigNome" placeholder="Digite seu nome completo" required>
                    </div>
                    
                    <div class="signature-field">
                        <label>CPF:</label>
                        <input type="text" id="sigCPF" placeholder="Digite seu CPF">
                    </div>
                    
                    <div class="signature-field">
                        <label>Data:</label>
                        <input type="date" id="sigData">
                    </div>
                    
                    <div class="signature-field">
                        <label>Assinatura :</label>
                        <input type="text" id="sigAssinatura" placeholder="Digite seu nome para assinatura" required>
                    </div>
                    <button class="btn btn-primary" id="btnAssinar" type="button">
                        <i class="fas fa-file-signature me-2"></i>Salvar Declara√ß√£o
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
    (async function(){
        // Aguardar carregamento da biblioteca Supabase
        await new Promise((resolve) => {
            if (typeof window.supabase !== 'undefined') {
                resolve();
            } else {
                const checkInterval = setInterval(() => {
                    if (typeof window.supabase !== 'undefined') {
                        clearInterval(checkInterval);
                        resolve();
                    }
                }, 100);
                setTimeout(() => {
                    clearInterval(checkInterval);
                    resolve();
                }, 3000);
            }
        });
        
        // Inicializar Supabase
        let supabaseClient = null;
        try {
            const configResp = await fetch('/api/supabase-config');
            if (configResp.ok) {
                const config = await configResp.json();
                if (typeof window.supabase !== 'undefined' && window.supabase.createClient) {
                    supabaseClient = window.supabase.createClient(config.supabaseUrl, config.supabaseAnonKey);
                    console.log('‚úÖ Cliente Supabase inicializado');
                } else {
                    console.warn('‚ö†Ô∏è Biblioteca Supabase n√£o dispon√≠vel');
                }
            }
        } catch (e) {
            console.warn('N√£o foi poss√≠vel inicializar Supabase:', e);
        }
        
        const btn = document.getElementById('btnAssinar');
        if(!btn) return;
        const today = new Date().toISOString().slice(0,10);
        const dataField = document.getElementById('sigData');
        if(dataField && !dataField.value) dataField.value = today;
        
        btn.addEventListener('click', async ()=>{
            const nome = document.getElementById('sigNome')?.value.trim();
            const cpf = document.getElementById('sigCPF')?.value.trim();
            const assinatura = document.getElementById('sigAssinatura')?.value.trim();
            if(!nome || !assinatura){
                alert('Preencha o Nome e a Assinatura.');
                return;
            }
            btn.disabled = true; 
            btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Salvando...';
            
            try{
                // Obter token de autentica√ß√£o do Supabase
                let authToken = null;
                if (supabaseClient) {
                    try {
                        const { data: session, error: sessionError } = await supabaseClient.auth.getSession();
                        if (sessionError) {
                            console.warn('‚ö†Ô∏è Erro ao obter sess√£o:', sessionError);
                        } else if (session?.session?.access_token) {
                            authToken = session.session.access_token;
                            console.log('‚úÖ Token de autentica√ß√£o obtido');
                        } else {
                            console.warn('‚ö†Ô∏è Sess√£o n√£o encontrada ou sem token');
                        }
                    } catch (e) {
                        console.warn('‚ö†Ô∏è N√£o foi poss√≠vel obter sess√£o:', e);
                    }
                } else {
                    console.warn('‚ö†Ô∏è Cliente Supabase n√£o inicializado');
                }
                
                const headers = {
                    'Content-Type': 'application/json'
                };
                
                // Adicionar token de autentica√ß√£o se dispon√≠vel
                if (authToken) {
                    headers['Authorization'] = `Bearer ${authToken}`;
                    console.log('üì§ Enviando requisi√ß√£o com token de autentica√ß√£o');
                } else {
                    console.warn('‚ö†Ô∏è Enviando requisi√ß√£o sem token (user_id ser√° null)');
                }
                
                const resp = await fetch('/api/treinamentos/assinaturas',{
                    method:'POST',
                    headers: headers,
                    credentials:'include',
                    body: JSON.stringify({
                        treinamento_slug: 'cadastro_motoristas',
                        nome,
                        cpf,
                        assinatura_texto: assinatura
                    })
                });
                
                if(!resp.ok){
                    const t = await resp.text();
                    throw new Error(t||'Falha ao salvar');
                }
                
                const json = await resp.json();
                alert('‚úÖ Declara√ß√£o registrada com sucesso em '+ (json.data_assinatura ? new Date(json.data_assinatura).toLocaleString('pt-BR') : new Date().toLocaleString('pt-BR')));
                
                // Limpar campos ap√≥s sucesso
                document.getElementById('sigNome').value = '';
                document.getElementById('sigCPF').value = '';
                document.getElementById('sigAssinatura').value = '';
                
            }catch(e){
                console.error('‚ùå Erro ao salvar assinatura:', e);
                alert('‚ùå Erro ao salvar declara√ß√£o: '+ (e.message || 'Erro desconhecido'));
            }finally{
                btn.disabled = false; 
                btn.innerHTML = '<i class="fas fa-file-signature me-2"></i>Salvar Declara√ß√£o';
            }
        });
    })();
    </script>
</body>
</html>
